const translations = {
  en: {
    appTitle: "Student Finance Assistant",
    navHome: "Home",
    navDashboard: "Dashboard",
    navBudget: "Budget",
    navExpenses: "Expenses",
    navSummary: "Summary",
    navGoal: "Goal",
    navProfile: "Profile",
    navProfile2: "Profile",
    languageHeader: "Language",

    welcomeTitle: "Welcome to Student Finance Assistant",
    welcomeDesc: "Manage your finances, track expenses, and achieve your financial goals with ease.",
    cardBudgetTitle: "Budget Overview",
    cardBudgetText: "Track and follow your expenses.",
    cardBudgetBtn: "View Budget",
    cardExpenseTitle: "Expense Tracker",
    cardExpenseText: "Track and follow your expenses.",
    cardExpenseBtn: "Track Expenses",
    cardGoalTitle: "Financial Goals",
    cardGoalText: "Set and achieve your financial goals.",
    cardGoalBtn: "Set Goals",
    cardSummaryTitle: "Summary",
    cardSummaryText: "View your annual spending summary.",
    cardSummaryBtn: "View Summary",
    insightsTitle: "Insights",
    insightsText: "Visualize your spending patterns with charts and graphs.",
    insightsBtn: "View Insights",

    dashboardTitle: "Student Cost Dashboard",
    labelUniversity: "University",
    labelHousing: "Housing",
    labelTransport: "Transport",
    optUniversityDefault: "-- Select University --",
    optHousingDefault: "-- Select Housing --",
    optTransportDefault: "-- Select Transport --",

    budgetTitle: "Fill Your Monthly Budget",
    labelMonth: "Select Month",
    labelTotalBudget: "Monthly Budget (Total)",
    labelCurrency: "Currency:",
    thLabel: "Expense Label",
    thAmount: "Amount",
    thPercentage: "Percentage",
    thFixed: "Fixed?",
    thAction: "Action",
    addExpenseBtn: "Add Expense",
    saveBudgetBtn: "Save Budget",
    labelGraph: "Choose Graph Type:",

    // Expenses page
    expensesTitle: "Track Your Expenses",
    selectMonthLabel: "Select Month",
    dateLabel: "Date",
    amountLabel: "Amount",
    categoryLabel: "Category",
    optCategoryDefault: "-- Select Category --",
    expenseHistoryTitle: "Expense History",
    tableDateHeader: "Date",
    tableAmountHeader: "Amount",
    tableCategoryHeader: "Category",
    tableActionsHeader: "Actions",
    transferModalLabel: "Transfer to a Goal",
    distributeRemainingLabel: "Distribute Remaining",
    totalRemainingText: "Total remaining available:",
    distributeSpentLabel: "Distribute Spent (Select Categories)",
    totalSelectedSavingsText: "Total selected savings:",
    transferBtn: "Transfer",
    goalTransfersTitle: "Goal Transfers This Month",
    goalTableDate: "Date",
    goalTableAmount: "Amount",
    goalTableGoal: "Goal",
    goalTableType: "Type",

    // Summary page
    summaryPageTitle: "Yearly Summary",
    highestExpensesTitle: "Highest Expenses",
    lowestExpensesTitle: "Lowest Expenses",
    summaryTitle: "Yearly Summary",
    totalSpentLabel: "Total Spent",
    totalExpensesLabel: "Total Expenses",
    totalRemainingLabel: "Remaining",
    highestExpenseLabel: "Highest Expense",
    lowestExpenseLabel: "Lowest Expense",
    mostSpentMonthLabel: "Month Most Spent",
    monthlyExpensesLabel: "Monthly Expenses",
    expensesByCategoryLabel: "Expenses by Category",
    expenseHistoryModalLabel: "Expense History",

    financialGoalsPageTitle: "Financial Goals",
    financialGoalsTitle: "Financial Goals",
    goalNameLabel: "Goal Name",
    targetAmountLabel: "Target Amount (€)",
    startDateLabel: "Start Date",
    endDateLabel: "End Date",
    targetLabel: "Target:",
    periodLabel: "Period:",
    progressLabel: "Progress:",
    setGoalBtn: "Set Goal",
  },

  fr: {
    appTitle: "Assistant Financier Étudiant",
    navHome: "Accueil",
    navDashboard: "Tableau de bord",
    navBudget: "Budget",
    navExpenses: "Dépenses",
    navSummary: "Résumé",
    navGoal: "Objectifs",
    navProfile: "Profil",
    navProfile2: "Profil",
    languageHeader: "Langue",

    welcomeTitle: "Bienvenue sur l'Assistant Financier Étudiant",
    welcomeDesc: "Gérez vos finances, suivez vos dépenses et atteignez vos objectifs financiers facilement.",
    cardBudgetTitle: "Vue d'ensemble du budget",
    cardBudgetText: "Suivez et planifiez vos dépenses.",
    cardBudgetBtn: "Voir le budget",
    cardExpenseTitle: "Suivi des dépenses",
    cardExpenseText: "Enregistrez et suivez vos dépenses.",
    cardExpenseBtn: "Suivre les dépenses",
    cardGoalTitle: "Objectifs financiers",
    cardGoalText: "Définissez et atteignez vos objectifs financiers.",
    cardGoalBtn: "Définir objectifs",
    cardSummaryTitle: "Résumé",
    cardSummaryText: "Voir le résumé annuel des dépenses.",
    cardSummaryBtn: "Voir le résumé",
    insightsTitle: "Analyses",
    insightsText: "Visualisez vos habitudes de dépenses avec des graphiques.",
    insightsBtn: "Voir les analyses",

    dashboardTitle: "Tableau des Coûts Étudiants",
    labelUniversity: "Université",
    labelHousing: "Logement",
    labelTransport: "Transport",
    optUniversityDefault: "-- Sélectionnez une université --",
    optHousingDefault: "-- Sélectionnez un logement --",
    optTransportDefault: "-- Sélectionnez un transport --",

    budgetTitle: "Remplissez votre budget mensuel",
    labelMonth: "Sélectionnez le mois",
    labelTotalBudget: "Budget mensuel (Total)",
    labelCurrency: "Devise :",
    thLabel: "Libellé",
    thAmount: "Montant",
    thPercentage: "Pourcentage",
    thFixed: "Fixe ?",
    thAction: "Action",
    addExpenseBtn: "Ajouter une dépense",
    saveBudgetBtn: "Enregistrer le budget",
    labelGraph: "Choisir le type de graphique :",

    // Expenses page
    expensesTitle: "Suivi de vos dépenses",
    selectMonthLabel: "Sélectionnez le mois",
    dateLabel: "Date",
    amountLabel: "Montant",
    categoryLabel: "Catégorie",
    optCategoryDefault: "-- Sélectionnez une catégorie --",
    expenseHistoryTitle: "Historique des dépenses",
    tableDateHeader: "Date",
    tableAmountHeader: "Montant",
    tableCategoryHeader: "Catégorie",
    tableActionsHeader: "Actions",
    transferModalLabel: "Transférer vers un objectif",
    distributeRemainingLabel: "Répartir le restant",
    totalRemainingText: "Total restant disponible :",
    distributeSpentLabel: "Répartir les dépenses (Sélectionner les catégories)",
    totalSelectedSavingsText: "Économies sélectionnées totales :",
    transferBtn: "Transférer",
    goalTransfersTitle: "Transferts vers objectifs ce mois-ci",
    goalTableDate: "Date",
    goalTableAmount: "Montant",
    goalTableGoal: "Objectif",
    goalTableType: "Type",

    // Summary page
    summaryPageTitle: "Résumé Annuel",
    summaryTitle: "Résumé Annuel",
    totalSpentLabel: "Total Dépensé",
    totalExpensesLabel: "Total des Dépenses",
    highestExpensesTitle: "Dépenses les plus élevées",
    lowestExpensesTitle: "Dépenses les plus basses",
    totalRemainingLabel: "Restant",
    highestExpenseLabel: "Dépense la plus élevée",
    lowestExpenseLabel: "Dépense la plus basse",
    mostSpentMonthLabel: "Mois le plus dépensier",
    monthlyExpensesLabel: "Dépenses Mensuelles",
    expensesByCategoryLabel: "Dépenses par Catégorie",
    expenseHistoryModalLabel: "Historique des dépenses",

    financialGoalsPageTitle: "Objectifs Financiers",
    financialGoalsTitle: "Objectifs Financiers",
    goalNameLabel: "Nom de l'objectif",
    targetAmountLabel: "Montant cible (€)",
    targetLabel: "Objectif :",
    periodLabel: "Période :",
    progressLabel: "Progression :",
    startDateLabel: "Date de début",
    endDateLabel: "Date de fin",
    setGoalBtn: "Définir l'objectif"
  },

  id: {
    appTitle: "Asisten Keuangan Mahasiswa",
    navHome: "Beranda",
    navDashboard: "Dasbor",
    navBudget: "Anggaran",
    navExpenses: "Pengeluaran",
    navSummary: "Ringkasan",
    navGoal: "Tujuan",
    navProfile: "Profil",
    navProfile2: "Profil",
    languageHeader: "Bahasa",

    welcomeTitle: "Selamat datang di Asisten Keuangan Mahasiswa",
    welcomeDesc: "Kelola keuangan Anda, lacak pengeluaran, dan capai tujuan keuangan Anda dengan mudah.",
    cardBudgetTitle: "Ikhtisar Anggaran",
    cardBudgetText: "Lacak dan rencanakan pengeluaran Anda.",
    cardBudgetBtn: "Lihat Anggaran",
    cardExpenseTitle: "Pelacak Pengeluaran",
    cardExpenseText: "Catat dan lacak pengeluaran Anda.",
    cardExpenseBtn: "Lacak Pengeluaran",
    cardGoalTitle: "Tujuan Keuangan",
    cardGoalText: "Tetapkan dan capai tujuan keuangan Anda.",
    cardGoalBtn: "Tetapkan Tujuan",
    cardSummaryTitle: "Ringkasan",
    cardSummaryText: "Lihat ringkasan pengeluaran tahunan Anda.",
    cardSummaryBtn: "Lihat Ringkasan",
    insightsTitle: "Wawasan",
    insightsText: "Visualisasikan pola pengeluaran Anda dengan grafik.",
    insightsBtn: "Lihat Wawasan",

    dashboardTitle: "Dasbor Biaya Mahasiswa",
    labelUniversity: "Universitas",
    labelHousing: "Tempat Tinggal",
    labelTransport: "Transportasi",
    optUniversityDefault: "-- Pilih Universitas --",
    optHousingDefault: "-- Pilih Tempat Tinggal --",
    optTransportDefault: "-- Pilih Transportasi --",

    budgetTitle: "Isi Anggaran Bulanan Anda",
    labelMonth: "Pilih Bulan",
    labelTotalBudget: "Anggaran Bulanan (Total)",
    labelCurrency: "Mata Uang:",
    thLabel: "Label Pengeluaran",
    thAmount: "Jumlah",
    thPercentage: "Persentase",
    thFixed: "Tetap?",
    thAction: "Aksi",
    addExpenseBtn: "Tambah Pengeluaran",
    saveBudgetBtn: "Simpan Anggaran",
    labelGraph: "Pilih Jenis Grafik:",

    // Expenses page
    expensesTitle: "Lacak Pengeluaran Anda",
    selectMonthLabel: "Pilih Bulan",
    dateLabel: "Tanggal",
    amountLabel: "Jumlah",
    categoryLabel: "Kategori",
    optCategoryDefault: "-- Pilih Kategori --",
    expenseHistoryTitle: "Riwayat Pengeluaran",
    tableDateHeader: "Tanggal",
    tableAmountHeader: "Jumlah",
    tableCategoryHeader: "Kategori",
    tableActionsHeader: "Aksi",
    transferModalLabel: "Transfer ke Tujuan",
    distributeRemainingLabel: "Distribusikan Sisa",
    totalRemainingText: "Total sisa yang tersedia:",
    distributeSpentLabel: "Distribusikan Pengeluaran (Pilih Kategori)",
    totalSelectedSavingsText: "Total tabungan terpilih:",
    transferBtn: "Transfer",
    goalTransfersTitle: "Transfer ke Tujuan Bulan Ini",
    goalTableDate: "Tanggal",
    goalTableAmount: "Jumlah",
    goalTableGoal: "Tujuan",
    goalTableType: "Tipe",

    // Summary page
    summaryPageTitle: "Ringkasan Tahunan",
    summaryTitle: "Ringkasan Tahunan",
    totalSpentLabel: "Total Pengeluaran",
    totalExpensesLabel: "Total Biaya",
    highestExpensesTitle: "Pengeluaran Tertinggi",
    lowestExpensesTitle: "Pengeluaran Terendah",
    totalRemainingLabel: "Sisa",
    highestExpenseLabel: "Pengeluaran Tertinggi",
    lowestExpenseLabel: "Pengeluaran Terendah",
    mostSpentMonthLabel: "Bulan Paling Boros",
    monthlyExpensesLabel: "Pengeluaran Bulanan",
    expensesByCategoryLabel: "Pengeluaran per Kategori",
    expenseHistoryModalLabel: "Riwayat Pengeluaran",

    financialGoalsPageTitle: "Tujuan Keuangan",
    financialGoalsTitle: "Tujuan Keuangan",
    goalNameLabel: "Nama Tujuan",
    targetLabel: "Target:",
    periodLabel: "Periode:",
    progressLabel: "Perkembangan:",
    targetAmountLabel: "Jumlah Target (€)",
    startDateLabel: "Tanggal Mulai",
    endDateLabel: "Tanggal Selesai",
    setGoalBtn: "Tetapkan Tujuan"
  }
};

function setLanguage(lang) {
  const strings = translations[lang];
  if (!strings) return;

  Object.entries(strings).forEach(([id, text]) => {
    const el = document.getElementById(id);
    if (el) el.textContent = text;
    // Pour le <title>
    if (id === "summaryPageTitle" && document.title) document.title = text;
  });

  localStorage.setItem('lang', lang);
  if (typeof updateGoalLabels === "function") updateGoalLabels();
  // On stocke la langue sur window pour l'utiliser dans getTranslation
  window.currentLang = lang;
  if (typeof fetchGoals === "function") fetchGoals(); // Pour re-render les gauges avec le bon texte
}

// Utilitaire globale pour la traduction dynamique dans les scripts
function getTranslation(key) {
  const lang = window.currentLang || localStorage.getItem('lang') || 'en';
  return (window.translations && window.translations[lang] && window.translations[lang][key]) || key;
}

function updateGoalLabels() {
  const lang = window.currentLang || localStorage.getItem('lang') || 'en';
  const strings = translations[lang];
  document.querySelectorAll('.targetLabel').forEach(el => el.textContent = strings.targetLabel || 'Target:');
  document.querySelectorAll('.periodLabel').forEach(el => el.textContent = strings.periodLabel || 'Period:');
}

// Pour que getTranslation fonctionne partout
window.translations = translations;

document.addEventListener("DOMContentLoaded", () => {
  const savedLang = localStorage.getItem('lang') || 'en';
  setLanguage(savedLang);

  document.querySelectorAll(".lang-option").forEach(el => {
    el.addEventListener("click", e => {
      e.preventDefault();
      const lang = e.target.dataset.lang;
      setLanguage(lang);
    });
  });
});